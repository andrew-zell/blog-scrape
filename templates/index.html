<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zoom Blog Curation</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', sans-serif;
      background: #00053D;
      overflow: hidden;
    }
    .main-container {
      display: flex;
      height: 100vh;
      width: 100vw;
    }
    .whats-new-section {
      width: 320px;
      min-width: 320px;
      background: linear-gradient(to bottom, #01D7F0 0%, #0B5FFF 100%);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .whats-new-text {
      color: #fff;
      font-size: 3.3rem;
      font-weight: 700;
      text-align: center;
      line-height: 1.1;
      letter-spacing: -1px;
      user-select: none;
    }
    .slideshow-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(90deg, #0B5FFF 0%, #00053D 100%);
      position: relative;
    }
    #slideshow {
      position: relative;
      width: 95%;
      height: 100%;
    }
    .slide {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: absolute;
      left: 0; top: 0; width: 100%; height: 100%;
      color: white;
    }
    .slide.active {
      opacity: 1;
      pointer-events: auto;
    }
    .slide-title {
      font-size: 4rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 36px;
      margin-top: 0;
      text-align: center;
      letter-spacing: -0.5px;
      width: 100%;
    }
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: clamp(16px, 4vw, 48px);
      width: 100%;
      justify-items: center;
      align-items: stretch;
      text-align: center;
    }
    .card {
      background: #fff;
      border-radius: 24px;
      padding: 18px 18px 12px 18px;
      max-width: 800px;
      width: 100%;
      min-width: 200px;
      flex: 0 1 200px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 2px 12px rgba(11,95,255,0.08);
      margin-bottom: 4px;
    }
    .card img {
      width: 100%;
      height: auto;
      border-radius: 12px;
      background: #e0e0e0;
      aspect-ratio: 16/9;
      object-fit: cover;
      margin-bottom: 12px;
    }
    .card p {
      font-size: 1.5rem;
      margin: 0;
      margin-top: 4px;
      color: #000;
      font-weight: 700;
      text-align: center;
      font-family: 'Montserrat', sans-serif;
    }
    @media (max-width: 900px) {
      .main-container { flex-direction: column; }
      .whats-new-section { width: 100vw; min-width: 0; max-width: none; height: 120px; }
      .slideshow-section { height: calc(100vh - 120px); }
      .slide {
        width: 98vw;
        max-width: 98vw;
        margin: 0 auto;
      }
    }
    @media (max-width: 700px) {
      .slide-title { font-size: 1.3rem; }
      .card { padding: 18px 8px 12px 8px; }
      .card-grid { gap: 16px; }
    }
    @media (min-aspect-ratio: 15/9) and (max-aspect-ratio: 17/9) {
    .card-grid {
    grid-template-columns: repeat(2, 1fr);
    grid-auto-rows: auto;
    justify-items: center;
  }
    .text-card {
      background: rgba(255,255,255,0.15) !important;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 150px;
    }
    .text-card p {
      color: #fff !important;
      font-size: 2.2rem !important;
    }
  </style>
</head>
<body>
  <div class="main-container">
    <div class="whats-new-section">
      <div class="whats-new-text">What's<br>New</div>
    </div>
    <div class="slideshow-section">
      <div id="slideshow"></div>
    </div>
  </div>
  <script>
    async function loadStories() {
      // Get the screen parameter from the URL
      function getScreenFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get('screen');
      }
      const screen = getScreenFromURL();
      let url = '/stories';
      if (screen) {
        url += '?screen=' + encodeURIComponent(screen);
      } else {
        // Fallback to active group if no screen param
        const groupRes = await fetch('/active_group');
        const groupData = await groupRes.json();
        const activeGroup = groupData.active;
        url += '?group=' + encodeURIComponent(activeGroup);
      }
      const res = await fetch(url);
      const stories = await res.json();
      renderSlideshow(stories);
    }
    function equalizeCardHeights() {
      const activeSlide = document.querySelector('.slide.active');
      if (!activeSlide) return;
      const cards = activeSlide.querySelectorAll('.card');
      let maxHeight = 0;
      cards.forEach(card => {
        card.style.height = 'auto'; // Reset first
        maxHeight = Math.max(maxHeight, card.offsetHeight);
      });
      cards.forEach(card => {
        card.style.height = maxHeight + 'px';
      });
    }
    function renderSlideshow(stories) {
      const container = document.getElementById('slideshow');
      container.innerHTML = '';
      const visibleStories = stories.filter(s => s.include !== false);
      if (visibleStories.length === 0) {
        container.innerHTML = '<div class="slide active"><div class="slide-title">No stories are currently visible.</div></div>';
        return;
      }
      visibleStories.forEach(story => {
        // Use story.content if available, fallback to images for legacy
        const contentBlocks = (story.content || (story.images || []).map(img => ({
          type: 'image',
          src: img.src,
          caption: img.caption,
          include: img.include !== false
        })));
        const visibleBlocks = contentBlocks.filter(block => block.include !== false);
        if (visibleBlocks.length > 0) {
          const slide = document.createElement('div');
          slide.className = 'slide';
          const title = document.createElement('div');
          title.className = 'slide-title';
          title.textContent = story.title;
          slide.appendChild(title);
          const cardGrid = document.createElement('div');
          cardGrid.className = 'card-grid';
          visibleBlocks.forEach(block => {
            const card = document.createElement('div');
            card.className = 'card';
            if (block.type === 'image') {
              card.innerHTML = `
                <img src="${block.src}" alt="${block.caption}">
                <p>${block.caption}</p>
              `;
            } else if (block.type === 'text') {
              card.classList.add('text-card');
            card.innerHTML = `
                <p style="font-size:1.2rem;font-weight:700;text-align:center;font-family:'Montserrat',sans-serif;margin:0;">${block.text || ''}</p>
            `;
            }
            console.log('Appending card:', block, card);
            cardGrid.appendChild(card);
          });
          console.log('cardGrid children:', cardGrid.children);
          slide.appendChild(cardGrid);
          container.appendChild(slide);
        }
      });
      startSlideshow();
      equalizeCardHeights();
    }
    function startSlideshow() {
      let index = 0;
      const slides = document.querySelectorAll('.slide');
      if (slides.length === 0) return;
      slides.forEach(slide => slide.classList.remove('active'));
      slides[0].classList.add('active');
      equalizeCardHeights();

      let interval = setInterval(nextSlide, 12000);

      function nextSlide() {
        slides[index].classList.remove('active');
        index = (index + 1) % slides.length;
        slides[index].classList.add('active');
        equalizeCardHeights();
      }

      // Add click-to-advance and reset timer
      const slideshowSection = document.querySelector('.slideshow-section');
      if (slideshowSection) {
        slideshowSection.onclick = () => {
          clearInterval(interval);
          nextSlide();
          interval = setInterval(nextSlide, 12000);
        };
      }
      // Re-equalize on window resize
      window.addEventListener('resize', equalizeCardHeights);
    }
    document.addEventListener('DOMContentLoaded', loadStories);
  </script>
</body>
</html> 
